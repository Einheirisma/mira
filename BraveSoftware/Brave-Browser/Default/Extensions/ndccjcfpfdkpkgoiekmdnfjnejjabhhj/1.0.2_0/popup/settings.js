(()=>{try{document.addEventListener("contextmenu",(e=>e.preventDefault()))}catch(e){}function e(e){return document.querySelector(`#${e}`)}function o(e){if(1==(e.match(/\*/g)||[]).length&&1==(e.match(/\./g)||[]).length)return!1;if("string"!=typeof e)return!1;let o=e.split(".");if(o.length<=1)return!1;let r=o.pop();return!!/^[a-zA-Z0-9-]+$/gi.test(r)&&o.every((e=>/^(?!:\/\/)([a-zA-Z0-9\*]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])$/gi.test(e)))}function r(e){return 0==e}function n(e){return new Promise((o=>{chrome.storage.local.set(e,o)}))}function a(e){return new Promise((o=>{chrome.storage.local.get(e,o)}))}function s(o,r){const n=e("message"),a=e("msgContainer");n.parentNode.removeChild(n),a.appendChild(n),n.style.color=r,n.innerText=o,n.style.display="table"}function t(e,o){e.addEventListener("change",(async()=>{"userProxy"==e.id?e.checked?o.style.display="block":o.style.display="none":"disableExtensions"!=e.id||await new Promise((e=>{chrome.permissions.contains({permissions:["management"]},(o=>e(o)))}))||(e.checked?await new Promise((e=>{chrome.permissions.request({permissions:["management"]},(o=>e(o)))}))&&n({disableExtensions:!0}):n({disableExtensions:!1}),d())}))}async function d(){const o=e("proxyMenu"),r=e("disableExtensions"),n=e("userProxy"),s=e("host"),i=e("port"),t=e("dropProxy"),d=e("displayIcon"),y=e("userDomains"),l=e("noProxy"),c=e("onlyProxy"),x=e("addProxy"),P=e("allProxy"),u=await a();1==u.icon?d.checked=!0:d.checked=!1,1==u.disableExtensions?r.checked=!0:r.checked=!1,1==u.user_proxy?(n.checked=!0,o.style.display="block",t.value=u.user_proxy_type,s.value=u.user_proxy_http,i.value=u.user_proxy_port):(n.checked=!1,o.style.display="none"),1==u.noProxy?l.checked=!0:l.checked=!1,u.onlyProxy?0==u.onlyProxyDomains.length?c.checked=!1:c.checked=!0:c.checked=!1,1==u.addProxy?x.checked=!0:x.checked=!1,1==u.allProxy?P.checked=!0:P.checked=!1,1==u.userDomains?y.checked=!0:(y.checked=!1,l.checked=!1,c.checked=!1,x.checked=!1,P.checked=!1)}d(),t(e("userProxy"),e("proxyMenu")),t(e("disableExtensions")),async function(){const o=e("message"),t=e("saveSettings"),y=e("notSaveSettings"),l=(e("proxyMenu"),e("dropProxy")),c=e("host"),x=e("port"),P=e("opt"),u=e("main"),m=e("displayIcon"),g=e("userProxy"),h=e("disableExtensions"),f=(e("domainsMenu"),e("noProxy")),p=e("onlyProxy"),k=e("addProxy"),D=e("allProxy");let v=!1;t.onclick=async()=>{if(await a(),m.checked?(n({icon:!0}),v=!0):(n({icon:!1}),v=!0),g.checked){if(!(c.value&&c.value.length>6&&x.value&&x.value.length>0))return n({user_proxy:!1,onlyProxy:!1,addProxy:!1,allProxy:!1}),s("Неправильный формат прокси","#ff0000"),void chrome.runtime.sendMessage({apply:"rebuild"});n({user_proxy:!0,user_proxy_type:l.value,user_proxy_http:c.value,user_proxy_port:x.value}),v=!0}else n({user_proxy:!1}),v=!0;if(h.checked?(n({disableExtensions:!0}),v=!0):(n({disableExtensions:!1}),v=!0),userDomains.checked){if(!(f.checked||p.checked||k.checked||D.checked))return s("Необходимо выбрать хотя бы одну из опций","#ff0000"),n({userDomains:!1,noProxy:!1,onlyProxy:!1,addProxy:!1,allProxy:!1}),void chrome.runtime.sendMessage({apply:"rebuild"});if(D.checked&&(p.checked||k.checked))return s("Выбранные опции нельзя использовать вместе","#ff0000"),g.checked||n({allProxy:!1}),void chrome.runtime.sendMessage({apply:"rebuild"});if(p.checked&&k.checked){s("Выбранные опции нельзя использовать вместе","#ff0000"),g.checked||n({onlyProxy:!1,allProxy:!1});let e=await a(["noProxy","onlyProxy","addProxy","allProxy"]);return Object.values(e).every(r)&&n({userDomains:!1}),void chrome.runtime.sendMessage({apply:"rebuild"})}if(f.checked&&p.checked)return s("Выбранные опции нельзя использовать вместе","#ff0000"),g.checked||n({allProxy:!1}),void chrome.runtime.sendMessage({apply:"rebuild"});if(f.checked&&D.checked){if(!g.checked)return s("Опция доступна только со своими прокси","#ff0000"),n({allProxy:!1}),void chrome.runtime.sendMessage({apply:"rebuild"});if(await a("noProxyDomains"),0==$("#noProxyDomains").tagEditor("getTags")[0].tags.length)return s("Список доменов не должен быть пустым","#ff0000"),n({noProxy:!1}),void chrome.runtime.sendMessage({apply:"rebuild"});n({noProxy:!0,allProxy:!0,addProxy:!1,onlyProxy:!1,noProxyDomains:$("#noProxyDomains").tagEditor("getTags")[0].tags}),v=!0}else if(f.checked&&k.checked){if(!g.checked)return s("Опция доступна только со своими прокси","#ff0000"),n({addProxy:!1}),void chrome.runtime.sendMessage({apply:"rebuild"});if(await a(["noProxyDomains","addProxyDomains"]),0==$("#noProxyDomains").tagEditor("getTags")[0].tags.length){s("Список доменов не должен быть пустым","#ff0000"),n({noProxy:!1,allProxy:!1});let e=await a(["noProxy","onlyProxy","addProxy","allProxy"]);return Object.values(e).every(r)&&n({userDomains:!1}),void chrome.runtime.sendMessage({apply:"rebuild"})}if(0==$("#addProxyDomains").tagEditor("getTags")[0].tags.length)return s("Список доменов не должен быть пустым","#ff0000"),n({noProxy:!1,addProxy:!1,allProxy:!1}),void chrome.runtime.sendMessage({apply:"rebuild"});n({noProxy:!0,onlyProxy:!1,addProxy:!0,allProxy:!1,noProxyDomains:$("#noProxyDomains").tagEditor("getTags")[0].tags,addProxyDomains:$("#addProxyDomains").tagEditor("getTags")[0].tags}),v=!0}else if(f.checked){if(await a("noProxyDomains"),0==$("#noProxyDomains").tagEditor("getTags")[0].tags.length)return s("Список доменов не должен быть пустым","#ff0000"),n({noProxy:!1,userDomains:!1}),void chrome.runtime.sendMessage({apply:"rebuild"});n({noProxy:!0,onlyProxy:!1,addProxy:!1,allProxy:!1,noProxyDomains:$("#noProxyDomains").tagEditor("getTags")[0].tags}),v=!0}else if(p.checked){if(!g.checked){s("Опция доступна только со своими прокси","#ff0000"),n({onlyProxy:!1});let e=await a(["noProxy","onlyProxy","addProxy","allProxy"]);return Object.values(e).every(r)&&n({userDomains:!1}),void chrome.runtime.sendMessage({apply:"rebuild"})}if(await a("onlyProxyDomains"),0==$("#onlyProxyDomains").tagEditor("getTags")[0].tags.length){s("Список доменов не должен быть пустым","#ff0000"),n({noProxy:!1,onlyProxy:!1,addProxy:!1,allProxy:!1});let e=await a(["noProxy","onlyProxy","addProxy","allProxy"]);return Object.values(e).every(r)&&n({userDomains:!1}),void chrome.runtime.sendMessage({apply:"rebuild"})}n({onlyProxy:!0,noProxy:!1,addProxy:!1,allProxy:!1,onlyProxyDomains:$("#onlyProxyDomains").tagEditor("getTags")[0].tags}),v=!0}else if(k.checked){if(!g.checked){s("Опция доступна только со своими прокси","#ff0000"),n({addProxy:!1});let e=await a(["noProxy","onlyProxy","addProxy","allProxy"]);return Object.values(e).every(r)&&n({userDomains:!1}),v=!1,void chrome.runtime.sendMessage({apply:"rebuild"})}if(await a("addProxyDomains"),0==$("#addProxyDomains").tagEditor("getTags")[0].tags.length){s("Список доменов не должен быть пустым","#ff0000"),n({noProxy:!1,onlyProxy:!1,addProxy:!1,allProxy:!1});let e=await a(["noProxy","onlyProxy","addProxy","allProxy"]);return Object.values(e).every(r)&&n({userDomains:!1}),void chrome.runtime.sendMessage({apply:"rebuild"})}n({addProxy:!0,noProxy:!1,onlyProxy:!1,allProxy:!1,addProxyDomains:$("#addProxyDomains").tagEditor("getTags")[0].tags}),v=!0}else if(D.checked){if(!g.checked){s("Опция доступна только со своими прокси","#ff0000"),n({allProxy:!1});let e=await a(["noProxy","onlyProxy","addProxy","allProxy"]);return Object.values(e).every(r)&&n({userDomains:!1}),void chrome.runtime.sendMessage({apply:"rebuild"})}n({allProxy:!0,noProxy:!1,onlyProxy:!1,addProxy:!1}),v=!0}n({userDomains:!0})}else n({userDomains:!1,noProxy:!1,onlyProxy:!1,addProxy:!1,allProxy:!1}),d(),v=!0;v&&(chrome.runtime.sendMessage({apply:"rebuild"}),s("Настройки успешно сохранены","#15d215"))},y.onclick=async()=>{const e=await a();function r(e,o){if(o&&o.length>0){let r;for(r=$(e).tagEditor("getTags")[0].tags,i=0;i<r.length;i++)$(e).tagEditor("removeTag",r[i],!0);r=o;for(let o=0;o<r.length;o++)$(e).tagEditor("addTag",r[o],!0)}else{let o=$(e).tagEditor("getTags")[0].tags;for(i=0;i<o.length;i++)$(e).tagEditor("removeTag",o[i],!0)}}o.style.display="none",d(),1==e.icon?m.checked=!0:m.checked=!1,1==e.user_proxy?g.checked=!0:g.checked=!1,P.style.display="none",u.style.display="block",r("#noProxyDomains",e.noProxyDomains),r("#onlyProxyDomains",e.onlyProxyDomains),r("#addProxyDomains",e.addProxyDomains)}}(),async function(){const{uid:o}=await a("uid");e("uid").innerText=o,e("ver").innerText=chrome.runtime.getManifest().version}(),async function(){const e=await a(["noProxyDomains","onlyProxyDomains","addProxyDomains"]);$("#noProxyDomains").tagEditor({initialTags:e.noProxyDomains,placeholder:"*.domain.com",onChange:function(e,r,n){let a=[];for(let e=0;e<n.length;e++)o(n[e])?a.push(n[e]):(s("Неправильный формат домена","#ff0000"),$("#noProxyDomains").tagEditor("removeTag",n[e]))}}),$("#onlyProxyDomains").tagEditor({initialTags:e.onlyProxyDomains,placeholder:"*.domain.com",onChange:function(e,r,n){let a=[];for(let e=0;e<n.length;e++)o(n[e])?a.push(n[e]):(s("Неправильный формат домена","#ff0000"),$("#onlyProxyDomains").tagEditor("removeTag",n[e]))}}),$("#addProxyDomains").tagEditor({initialTags:e.addProxyDomains,placeholder:"*.domain.com",onChange:function(e,r,n){let a=[];for(let e=0;e<n.length;e++)o(n[e])?a.push(n[e]):(s("Неправильный формат домена","#ff0000"),$("#addProxyDomains").tagEditor("removeTag",n[e]))}})}()})();